#!/bin/execlineb -P

backtick -E -n USER { whoami }
backtick -E -n UID { id -u }

foreground { install -d /run/${UID}/env }

s6-envdir "/run/${UID}/env"

define SERVICENAME xdg-desktop-portal-gtk
define LOGDIR /home/${USER}/.local/share/s6/log/${SERVICENAME}

# create log dir with right perms
foreground { if -n { test -d ${LOGDIR} } install -d ${LOGDIR} }
# pipe into logger
pipeline -w { exec -c s6-log -b -- t p${SERVICENAME}: ${LOGDIR} }
fdmove -c 2 1

exec /usr/lib/xdg-desktop-portal-gtk
